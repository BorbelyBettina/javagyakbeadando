<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('Megyénkénti városok száma')}">
    <style>
        .section { padding: 100px 5%; text-align: center; }
        h2 { font-size: 2.5rem; margin-bottom: 40px; color: #2c3e50; }
        canvas { max-width: 100%; margin: 0 auto; display: block; }
    </style>
</head>
<body class="is-preload landing">
<div id="page-wrapper">

    <!-- HEADER -->
    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <!-- Chart szekció -->
    <section class="section">
        <h2>Megyénkénti városok száma</h2>
        <canvas id="myChart" width="600" height="250"></canvas>
    </section>

    <!-- FOOTER -->
    <th:block th:replace="~{fragments/footer :: footer}"></th:block>

</div>

<!-- Chart.js külön scriptként -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    let labels = /*[[${labels}]]*/ [];
    let data = /*[[${data}]]*/ [];

    const budapestIndex = labels.indexOf('Budapest');
    if (budapestIndex !== -1) data[budapestIndex] = 1;

    let combined = labels.map((label, i) => ({label: label, value: data[i]}));
    const budapestObj = combined.find(c => c.label === 'Budapest');
    combined = combined.filter(c => c.label !== 'Budapest');
    combined.sort((a, b) => b.value - a.value);
    if (budapestObj) combined.push(budapestObj);

    labels = combined.map(c => c.label);
    data = combined.map(c => c.value);

    new Chart(document.getElementById("myChart"), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Városok száma',
                data: data,
                borderWidth: 1,
                backgroundColor: '#bf534e',
                borderColor: '#bf534e',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
            },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

</body>
</html>

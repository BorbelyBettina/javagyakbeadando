<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head('Megyénkénti városok száma')}"></head>

<style>
    /* Fő szekció sötét háttér */
    #one.wrapper.style2.special {
        background-color: rgb(28, 29, 38) !important;
    }

    /* Canvas középre igazítás és max szélesség */
    #chart-container {
        max-width: 800px;
        margin: 0 auto;
    }

    /* H2 stílus a téma szerint */
    h2 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
    }

    /* Navbar stílus (ha kell) */
    .navbar a {
        color: white;
        text-decoration: none;
        margin-right: 15px;
    }
</style>

<body class="is-preload landing">
<div id="page-wrapper">

    <!-- Header -->
    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <section id="one" class="wrapper style2 special">
        <div class="container">
            <h2>Megyénkénti városok száma</h2>

            <div id="chart-container">
                <canvas id="myChart" width="600" height="250"></canvas>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <th:block th:replace="~{fragments/footer :: footer}"></th:block>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    let labels = /*[[${labels}]]*/ [];
    let data = /*[[${data}]]*/ [];

    // Budapest értékét 1-re állítjuk mert mind a 23 megyét városnak számolja
    const budapestIndex = labels.indexOf('Budapest');
    if (budapestIndex !== -1) {
        data[budapestIndex] = 1;
    }

    let combined = labels.map((label, i) => ({label: label, value: data[i]}));

    const budapestObj = combined.find(c => c.label === 'Budapest');
    combined = combined.filter(c => c.label !== 'Budapest');

    combined.sort((a, b) => b.value - a.value);

    if (budapestObj) combined.push(budapestObj);

    labels = combined.map(c => c.label);
    data = combined.map(c => c.value);

    new Chart(document.getElementById("myChart"), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Városok száma',
                data: data,
                borderWidth: 1,
                backgroundColor: '#bf534e',
                borderColor: '#bf534e',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top', labels: { color: 'white' } },
            },
            scales: {
                x: { ticks: { color: 'white' } },
                y: { beginAtZero: true, ticks: { color: 'white' } }
            }
        }
    });
</script>

</body>
</html>
